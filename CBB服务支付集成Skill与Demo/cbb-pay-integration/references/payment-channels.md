# CBB 支付渠道参考

## 支付渠道枚举

### 微信支付渠道

| 渠道代码 | 描述 | 支付环境 | 说明 |
|---------|------|---------|------|
| WX_PAGE | 微信PC扫码支付 | PC | 用户使用微信扫描二维码完成支付 |
| WX_WAP | 微信H5支付 | WAP | 手机浏览器中唤起微信支付 |
| WX_OFFICIAL | 微信公众号支付 | WE_CHAT_OFFICIAL | 微信公众号内支付 |
| WX_MINI_PROGRAM | 微信小程序支付 | WE_CHAT_MINI_PROGRAM | 微信小程序内支付 |
| WX_APP | 微信APP支付 | APP | 原生APP中调用微信支付 |

### 支付宝渠道

| 渠道代码 | 描述 | 支付环境 | 说明 |
|---------|------|---------|------|
| ALIPAY_PAGE | 支付宝PC支付 | PC | PC端跳转支付宝页面支付 |
| ALIPAY_WAP | 支付宝H5支付 | WAP | 手机浏览器中唤起支付宝支付 |
| ALIPAY_APP | 支付宝APP支付 | APP | 原生APP中调用支付宝支付 |

---

## 支付环境说明

| 环境代码 | 说明 | 适用场景 |
|---------|------|---------|
| PC | 电脑端网站 | 桌面浏览器访问的网站 |
| WAP | 手机端网站 | 手机浏览器访问的H5页面 |
| WE_CHAT_OFFICIAL | 微信公众号 | 微信公众号内嵌H5页面 |
| WE_CHAT_MINI_PROGRAM | 微信小程序 | 微信小程序应用 |
| APP | 手机APP | iOS/Android原生应用 |

---

## 渠道支持矩阵

| 支付渠道 | PC | WAP | 公众号 | 小程序 | APP |
|---------|:--:|:---:|:-----:|:-----:|:---:|
| 微信支付 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 支付宝 | ✅ | ✅ | ❌ | ❌ | ✅ |

---

## 第三方支付类型

| 类型代码 | 说明 |
|---------|------|
| WE_CHAT | 微信支付 |
| ALIPAY | 支付宝 |

---

## 各环境对接要点

### PC端（扫码支付）

1. 调用创建订单接口获取 tradeNo
2. 调用获取二维码接口获取 qrCodeUrl
3. 将 qrCodeUrl 生成二维码图片展示给用户
4. 用户使用微信/支付宝扫码完成支付
5. 轮询订单状态或等待回调通知

### 移动端H5

1. 调用创建订单接口获取 tradeNo
2. 构造页面服务签名参数
3. 跳转到 CBB 支付页面
4. 用户选择支付方式完成支付
5. 支付完成后跳转到 turnUrl

### 微信公众号

1. 获取用户 openId（通过微信授权）
2. 调用创建订单接口获取 tradeNo
3. 构造页面服务签名参数（包含 openId）
4. 跳转到 CBB 支付页面
5. 用户在微信内完成支付

### 微信小程序

1. 获取用户 openId
2. 调用创建订单接口获取 tradeNo
3. 调用获取小程序支付参数接口
4. 使用 wx.requestPayment 调起支付
5. 处理支付结果

### APP支付

1. 调用创建订单接口获取 tradeNo
2. 调用获取APP支付参数接口（需要额外实现）
3. 使用微信/支付宝SDK调起支付
4. 处理支付结果

---

## 渠道配置要求

### 微信支付配置

- 微信商户号
- API密钥
- 证书文件（退款需要）
- 公众号/小程序 AppID（公众号/小程序支付需要）

### 支付宝配置

- 支付宝应用ID
- 应用私钥
- 支付宝公钥

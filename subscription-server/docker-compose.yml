services:
  subscription:
    build: .
    container_name: whatyterm-subscription
    restart: unless-stopped
    ports:
      - "3100:3100"
    volumes:
      - ./data:/app/data
    environment:
      - PORT=3100
      - JWT_SECRET=${JWT_SECRET:-whatyterm-subscription-secret-2025}
      - LICENSE_SECRET=${LICENSE_SECRET:-whatyterm-license-secret-2025}
      - ADMIN_KEY=${ADMIN_KEY:-whatyterm-admin-2025}
      # CBB 聚合支付配置
      - CBB_GATEWAY_URL=https://api.webtrn.cn
      - CBB_CLIENT_ID=2004201503566462
      - CBB_CLIENT_SECRET=7h9jpT8Xeg0Rs4VlL6nrNNb1ko4gvQ7lc0ox34Zx
      - CBB_CUSTOMER_CODE=api
      - CBB_PRIVATE_KEY=MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAIwrNXhKzgfaEcPWji035WKTnjh65rMqmXGJJ+NVESz+hIOgjBENHzwbgxQcGmNo3TvM40gmlWb1OttVSAN5xVi2CtGmpV2inOPn6xOQa0+EyiJkU0RaqLA8zbqDn+g8fKTsG7LeQdmuHHlaDt5LLOJ2jxOR5qL6XWseOSrYO8NPAgMBAAECgYBb2PRwnpPjEUIS0cTYXIgy0Agdemsxe/iQLQ+2J0fZ8+1hUxJ1GeQdvullhATGnzBYvykvXhkIHikzD+7gWCq3vRmTdVKdqHP2TT1NAIIq6ajJ2TupSmrzDW8EI6pgxfCbQ+sJFA6FAlsJkPkpEgyoFiGRISRi1QTYc1v3FY6AAQJBANEeFS9mydj6vJv8NyrCk1Nw7m5NJZEWHFaKj+qvX+ZILhcUrleu6t+mzMVJEU8tGI7mbRpQ0v45AP68Wtw3FwECQQCrl/ClLnC3mNBNiHUEqZ7vnAsgVvzLvbRfw6JIiwWRnlQupacPBHn18lwzFlZDyUQqXgURZnrx/HckIoVK9apPAkBulAjB0wnDSfs4RKtrWg6LnfkGrJbD3LxJauXlRK1iWSK+I7p5NU6Py2UWoaechY0p62Ef/ENGGSCUk0c8kYkBAkBpf3gHxp6scnqXQK9ZV4QNIy5ACttP1GmieyA6Y6bf2a0+JMCqXgEx8nk3O6N797E+LyIEibJLNwJ1J/g1lwbHAkAXmZAwtUG7tcHikNk+D2aYKWgVKokMS77Vmi80E36LYxRbx/SlXG6rxRM8rIa+duwAHiM4D4qTAbeIYQXr0h+H
      - CBB_PUBLIC_KEY=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDGXEIuVEjZCzzPGibTMF4LK7To/G4Cmmf7t7k1/U5XaLrQQoXPGLOm08AxNJLlQtcF5NC6tf10GM8JzHdeoAo1xmpwBHHBNQdPEnKAA2pNdMaJWzF2XZFpJ9SWLVSmrXmjFNDULo643CArFGdQddSd8DLYWUbKUo6GJjFKANEhfQIDAQAB
      - CBB_NOTIFY_URL=https://term.whaty.org/api/payment/cbb/notify
      - CBB_RETURN_URL=https://term.whaty.org/payment/result
      # 支付宝配置（暂未配置）
      - ALIPAY_APP_ID=${ALIPAY_APP_ID}
      - ALIPAY_PRIVATE_KEY=${ALIPAY_PRIVATE_KEY}
      - ALIPAY_PUBLIC_KEY=${ALIPAY_PUBLIC_KEY}
      - ALIPAY_NOTIFY_URL=${ALIPAY_NOTIFY_URL:-https://term.whaty.org/api/payment/alipay/notify}
      - ALIPAY_RETURN_URL=${ALIPAY_RETURN_URL:-https://term.whaty.org/payment/result}
      # 微信支付配置
      - WECHAT_MCHID=${WECHAT_MCHID}
      - WECHAT_API_KEY=${WECHAT_API_KEY}
      - WECHAT_SERIAL_NO=${WECHAT_SERIAL_NO}
      - WECHAT_PRIVATE_KEY=${WECHAT_PRIVATE_KEY}
      - WECHAT_PLATFORM_CERT=${WECHAT_PLATFORM_CERT}
      - WECHAT_APP_ID=${WECHAT_APP_ID}
      - WECHAT_NOTIFY_URL=${WECHAT_NOTIFY_URL:-https://term.whaty.org/api/payment/wechat/notify}
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3100/api/plans"]
      interval: 30s
      timeout: 10s
      retries: 3
